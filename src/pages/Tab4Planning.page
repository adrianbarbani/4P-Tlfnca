<apex:page controller="Tab4PlanningController" sidebar="false" showHeader="true" docType="html-5.0">
    
    <apex:includeScript value="{!URLFOR($Resource.bootstrapSF, 'js/JQueryToBS.js')}"/>
    <apex:includeScript value="{!URLFOR($Resource.bootstrapSF, 'js/bootstrap.min.js')}"/>
    <apex:includeScript value="{!$Resource.JQueryUI}"  />
    <apex:includeScript value="{!$Resource.JQueryUITouch}" />
    <!--apex:includeScript value="{!$Resource.DataTable}"  /-->
    <apex:includeScript value="{!$Resource.DataTable11012}"  />
    
    
    <!-- Sacado de https://plot.ly/javascript/ -->
    <apex:includeScript value="{!$Resource.Ploty}"/>    
    
    <apex:includeScript value="{!$Resource.html2canvas}"/>
    <apex:includeScript value="{!$Resource.RGBColor}"/>
    <apex:includeScript value="{!$Resource.Canvg}"/>
    <apex:includeScript value="{!$Resource.StackBlur}"/>
    <apex:includeScript value="{!URLFOR($Resource.TimeLineJs3, 'js/timeline-min.js')}" />
    
    
    <!--apex:stylesheet value="{!URLFOR($Resource.TimeLineJs3, 'css/timeline.css')}"/-->
    
    <script>
    $j = jQuery.noConflict();
    
    window.onload = function() {
        //load '../path/to/your.svg' in the canvas with id = 'canvas'
        //canvg();
    }
    
    $j(document).ready(function() {
        
        iniciarDataTable();
        
        $j("[id$=campoNombre]").keyup(function(event){
            if(event.keyCode == 13){
                $j("[id$=thebutton]").click();
            }
        });
        
        $j(window).on("resize", function () {
            ajustarTamanio();
        }).resize(); 
        
        function inputLookupUsuario(){
            $j('.inputLookupUsuario').val('');
        }
        
        function ajustarTamanio(){
            var WidthGraficos = $j('#graficos').width();
            
            if(WidthGraficos > 1600){
                
                $j('.svg-container').each(function() {
                    
                        if($j(this).parent().parent().attr('id') != 'desarrolloCuenta'){
                           $j( this ).css("width","50%");
                           $j( this ).css("margin","0 auto");
                        }
                });
                
                $j('#myDiv').css("margin-left","-5%");
                
            }else{
                $j('.svg-container').css("width","");
                $j('.svg-container').css("margin","");
                $j('#myDiv').css("margin-left","");
            }
            
        }
        
        colorearLineaDeTiempo();
        
        $j(".removeSpan").on("click",function(){
            $j("input",$j("#value"+$j(this).attr("id"))).val("");
            $j("select",$j("#field"+$j(this).attr("id"))).val("ninguno").change();
            $j("select",$j("#operator"+$j(this).attr("id"))).val("ninguno").change();
        });
        
        
        verFiltros($j("select",$j("#field1Span")));
        
        $j("select",$j("#field1Span")).change(function(){
            verFiltros($j(this));  
        });
        
    });
    
    
    
     function resetCamposMail(){
        
        
        $j('.resetMail').each(function() {
            $j(this).val("");    
        });
    
     }
    
    
    
    function verFiltros(elem){
        if(elem.val() === 'true'){
            $j(".filtrosSiBuscaConFourPlanning").fadeIn();
        }else{
            $j(".filtrosSiBuscaConFourPlanning").fadeOut();
        }
    }
    
    function marcarTodas(elem, tabla){
        
        var valores = document.getElementsByClassName(tabla);
        var i;
        
        for(i = 0; i< valores.length; i++){
            
            if(elem.checked){
                valores[i].checked = true;
                
            } else {
                valores[i].checked = false;
            }
        }
    }
    
	function noenter(ev)  {
	   	if (window.event && window.event.keyCode == 13 || ev.which == 13) {
	   		doSearchAF();
	       	return false;
	     } else {
	          return true;
	     }
	 }
 
    
    function colorearLineaDeTiempo(){
        $j('h2').each(function() {
            
            var contenido = $j(this).text();
            
            if(contenido == 'Reto' || contenido == '{!$Label.certa_scp__reto}'){
                var parent = $j(this).parent().parent().parent();
                if(parent.hasClass("tl-timemarker-content-container")){
                    parent.addClass("colorReto");
                }
            }
            
            if(contenido == 'Vencimiento' || contenido == 'Vencimiento Contrato Activo con Telefónica' || contenido == '{!$Label.certa_scp__vencimiento_contrato_activo_con_telef_nica}' || contenido == '{!$Label.certa_scp__vencimiento}'){
                var parent = $j(this).parent().parent().parent();
                if(parent.hasClass("tl-timemarker-content-container")){
                    parent.addClass("colorVencimiento");
                }
            }
            
            if(contenido == 'Vencimiento Contrato Activo con la Competencia' || contenido == '{!$Label.certa_scp__vencimiento_contrato_activo_con_la_competencia}'){
                var parent = $j(this).parent().parent().parent();
                if(parent.hasClass("tl-timemarker-content-container")){
                    parent.addClass("colorVencimientoCompetencia");
                }
            }
            
            if(contenido == 'Publicación RFP Comunicaciones' || contenido == '{!$Label.certa_scp__publicaci_n_rfp_comunicaciones}'){
                var parent = $j(this).parent().parent().parent();
                if(parent.hasClass("tl-timemarker-content-container")){
                    parent.addClass("RFPComunicaciones");
                }
            }
            
            if(contenido == 'Publicación RFP TI' || contenido == '{!$Label.certa_scp__publicaci_n_rfp_ti}'){
                var parent = $j(this).parent().parent().parent();
                if(parent.hasClass("tl-timemarker-content-container")){
                    parent.addClass("RFPTI");
                }
            }
            
            if(contenido == 'Evento para clientes de Telefonica' || contenido == 'Evento Telefónica' || contenido == '{!$Label.certa_scp__evento_para_clientes_de_telefonica}' || contenido == '{!$Label.certa_scp__evento_telef_nica}'){
                var parent = $j(this).parent().parent().parent();
                if(parent.hasClass("tl-timemarker-content-container")){
                    parent.addClass("clientes");
                }
            }
            
            if(contenido == 'Evento Relevante de la industria' || contenido == '{!$Label.certa_scp__evento_relevante_de_la_industria}'){
                var parent = $j(this).parent().parent().parent();
                if(parent.hasClass("tl-timemarker-content-container")){
                    parent.addClass("eventoRelevante");
                }
            }
            
            if(contenido == 'Previsión Cierre TOP 3 deals' || contenido == '{!$Label.certa_scp__previsi_n_cierre_top_3_deals}'){
                var parent = $j(this).parent().parent().parent();
                if(parent.hasClass("tl-timemarker-content-container")){
                    parent.addClass("topTres");
                }
            }
            
        });
    }
    
    </script>
    
    <style>
        table.dataTable thead .sorting {
        background: #f2f3f3 url("{!URLFOR($Resource.DataTableImg, 'sort_both.png')}") no-repeat center right ! important;
        }
        table.dataTable thead .sorting_asc {
        background: #f2f3f3 url("{!URLFOR($Resource.DataTableImg, 'sort_asc.png')}") no-repeat center right ! important;
        }
        table.dataTable thead .sorting_desc {
        background: #f2f3f3 url("{!URLFOR($Resource.DataTableImg, 'sort_desc.png')}") no-repeat center right ! important;
        }
        table.dataTable thead .sorting_asc_disabled {
        background: #f2f3f3 url("{!URLFOR($Resource.DataTableImg, 'sort_asc_disabled.png')}") no-repeat center right ! important;
        }
        table.dataTable thead .sorting_desc_disabled {
        background: #f2f3f3 url("{!URLFOR($Resource.DataTableImg, 'sort_desc_disabled.png')}") no-repeat center right ! important;
        }
        
        table.dataTable thead .sorting_asc,
        table.dataTable thead .sorting_desc,
        table.dataTable thead .sorting {
        cursor: pointer;
        *cursor: hand;
        }
        
        .dataTables_filter {
        text-align: right ! important;
        padding-right: 15px ! important;
        }
        
        .abbrTd div {
        width: 200px;
        }
        
        .bootstrap-sf1 * {
        font-family:  Calibri, ProximaNovaSoft-Regular, 'Helvetica Neue', 'Gill Sans', 'Gill Sans MT', Candara, Segoe, 'Segoe UI', Arial, sans-serif;
        //background-color: white; 
        }
        
        .paddingRight {
        padding-right: 15px;
        }
        
        .inlineEditUndo {
        display: none;
        }
        
        .inlineEditWriteOn {
        background: rgba(0, 0, 0, 0) url("/img/func_icons/util/pencil12.gif") no-repeat scroll right 2px;		    
        }
        
        .PopupHolderOpp {
        float:right;
        margin-right: 6px;
        margin: 5px;
        cursor: pointer;
        }
        
        .PopupHolderOpp *{
        box-sizing: content-box ! important;
        }
        
        .pbSubheader h3 {
        display: inline;
        margin-left: 5px;
        font-weight: bold;
        }
        
        .PopupHolderOpp .pbHeader {
        border:0px;
        border-top: 3px solid #f3ae4e !important;
        }
        
        .PopupHolderOpp .pbHeader .mainTitle {
        font-size: 18px !important;
        font-weight: bold !important;	
        }
        
        .PopupHolderOpp .pbBody .labelCol {
        font-size: 16px !important;
        font-weight: bold !important;	
        }
        
        .PopupHolderOpp .pbBody .dataCol {
        font-size: 16px !important;
        font-weight: normal !important;
        }
        
        .abbrTd span {
        overflow: hidden;
        width: 100%;
        text-overflow: ellipsis;
        white-space: nowrap; 
        display: inline-block;
        }
        
        .abbrOpp {
        width: 60px;
        overflow: hidden;
        display: inline-flex;
        }
        
        .PopupHolder {
        float:left;
        margin-right: 6px;
        }
        
        .NotUsed{
        background-color: #FF2D2D ! important;
        }
        
        .hasPotentialBussiness {
        background-color: #3796F7 ! important;    
        }
        
        .hasOpportunity {
        background-color: #128E2C  ! important;        
        }
        
        .vendidoEnElPasado{
        background-color: #FFC200 ! important;
        }
        
        .noAplica{
        background-color: #808080 ! important;
        }
        
        .hasOpportunityAndPotencial{
        background: #3796F7 ; 
        background-color:  #128E2C ! important;
        }
        
        .NotUsedSampleText, .hasPotentialBussinessSampleText, .hasOpportunitySampleText {
        /*font-weight:bold;  margin:10px*/
        font-size:14px;
        }
        
        .NotUsedSample, .hasPotentialBussinessSample, .hasOpportunitySample {
        /*border: 1px solid black;*/    
        width: 20px;
        height: 20px;
        /*line-height: 30px;*/    
        }
        
        .NotUsedSampleText {    
        color: white ! important;
        color: #2d839a ! important;
        }
        .NotUsedSample {    		    
        background-color: #FF2D2D ! important;		    
        }
        
        .hasPotentialBussinessSampleText {    
        color: #1797c0 ! important;
        color: #2d839a ! important;
        }
        .hasPotentialBussinessSample {    		    
        background-color: #3796F7 ! important;        	
        }
        
        .hasOpportunitySampleText {    
        color: #FEE ! important;
        color: #2d839a ! important;
        } 
        
        .hasOpportunitySample {
        background-color: #128E2C ! important;       	
        }
        
        .ScrollingDiv{
        overflow-y:auto;
        overflow-x: auto;
        max-height:300px;
        /*max-width: 800px;*/
        }
        
        .AddPopup {
        position: absolute;
        margin-top: 14px;
        padding: 5px;
        background-color: #eee;
        border: 1px solid black;
        width: 100px;
        white-space: normal;
        min-height: 14px;
        margin-left: -43px;
        border-radius: 3px;
        display:none;
        }
        
        .ui-state-hover{
        background-color: lightgreen ! important;
        }
        
        .ui-draggable-dragging{
        background-color: white;
        border: 1px solid gray;
        }
        
        .ui-draggable-dragging>td{
        padding-left: 4px;
        padding-right: 2px;
        }
        
        .ui-draggable-dragging>.TdName, .ui-draggable-dragging>.TdLink{
        display:none;
        }
        
        .DraggableRow{
        cursor:move;
        }
        
        .PopupHolder{
        float:right;
        margin-right: 6px;
        margin: 5px;
        }
        
        .PopupHolder *{
        box-sizing: content-box;
        }
        
        #mainTable th, #mainOppsTable th{
        padding-right: 15px;
        }
        
        .dataTables_filter {
        text-align: right ! important;
        padding-right: 15px ! important;
        } 
        
        .label-link a {
        color: white;
        }
        
        .removeSpan {
        cursor: pointer;
        text-decoration: underline;
        }
        
        .filterHelpImage {
        width: 20px;
        height: 20px;
        background: url('/img/help/helpOrbs.gif');
        background-size: 55px 20px;
        background-repeat: no-repeat;
        background-position: -30px 0px;
        cursor: pointer; 
        }
        
        #filterDiv select {
        width: 120px;
        }
        
        #filterDiv input {
        width: 120px;
        }
        
        #mainTableSolutions td.itemSelected {
        border: 2px solid #539fc6;
        border-style:double;
        }
        
        .hiddenTable {
        //display: none;
        }
        
        .solucionItems{
        padding:inherit;
        }
        
        div.divS{
        border: 2px solid #539fc6 !important;
        }
        
        div.bordesSinColor{
        border: 2px solid #FFFFFF;
        margin: 1% 0% 1% 0%;
        }
        
        .filtrosSiBuscaConFourPlanning{
        display: none;
        }
        
        .modebar{
        display:none;
        }
        
        .colorVencimiento{
        background-color:red !important;
        }
        
        .colorVencimientoCompetencia{
        background-color:hsla(132,100%,40%,1) !important;
        }
        
        .colorVencimientoSecundario{
        background-color:hsla(132,100%,55%,1) !important;
        }
        
        .RFPComunicaciones{
        background-color:hsla(273,100%,66%,1) !important;
        }
        
        .RFPTI{
        background-color:hsla(30,100%,50%,1) !important;
        }
        
        .clientes{
        background-color:hsla(359,100%,75%,1) !important;
        }
        
        .eventoRelevante{
        background-color:hsl(218, 100%, 75%) !important;
        }
        
        .topTres{
        background-color:hsla(57,100%,69%,1) !important;
        }
        
        .colorReto{
        background-color:hsla(154,98%,39%,1) !important;
        }
        
        .colorOtros{
        background-color: white !important;
        }
        
        .colorSpanReferencias{
        background-color: #d9edf2;
        }
        
        .separador{
        border: solid 0.5px #edeff0;
        }
        
        .tl-attribution{
        display:none !important;
        }
        /*
        .svg-container{
        width: 50% !important;
        margin: 0 auto !important;
        } */
        
        .modal-dialog{
        overflow-y: initial !important
        }
        .modal-body{
        height: 250px;
        overflow-y: auto;
        }
        
    </style>
    
    <apex:stylesheet value="{!URLFOR($Resource.bootstrapSF, 'css/bootstrap-namespaced.min.css')}"/>	 
    <apex:stylesheet value="{!URLFOR($Resource.bootstrapSF, 'css/BSCustomSyles.css')}"/>
    
    <link title="timeline-styles" rel="stylesheet" href="https://cdn.knightlab.com/libs/timeline3/latest/css/timeline.css"/>
    
    <apex:form id="pageForm">
        
        <apex:actionFunction action="{!establecerValoresDeLaLineaDeTiempo}" oncomplete="colorearLineaDeTiempo();iniciarDataTable();" name="renderizarLineaDeTiempoConDatosActuales" rerender="listaDeClientes, timeLine, panelesDeLineaDeTiempo, filtrosDeLineTime" />
       
        
        
        <div class="bPageTitle">
            <div class="ptBody">
                <div class="content" style="width:100%">
                    <apex:image id="theImage" value="{!$Resource.Logo4Planning}" height="120" style="display: block;margin-left: auto;margin-right: auto;margin-top: 1px;"/>
                </div>
            </div>
        </div>
        
        <br/>
        
        <!-- Graficos Ploty -->
        <!-- primer Grafico, coeficiente de desarrollo de territorio -->
        <div id="graficos">
            
            <apex:outputPanel id="graficosARenderizar">
                <div id="myDiv" style="width:33%;height: 450px; margin-bottom: -180px;position:relative;z-index:0;float:left"></div>
                
                <script>
                // Trig to calc meter point
                var degrees = ((100-{!promedioCoeDesarrollo})*90)/50,
                    radius = .5;
                var radians = degrees * Math.PI / 180;
                var x = radius * Math.cos(radians);
                var y = radius * Math.sin(radians);
                
                // Path: may have to change to create a better triangle
                var mainPath = 'M -.0 -0.025 L .0 0.025 L ',
                    pathX = String(x),
                    space = ' ',
                    pathY = String(y),
                    pathEnd = ' Z';
                var path = mainPath.concat(pathX,space,pathY,pathEnd);
                
                var data = [{ type: 'scatter',
                             x: [0], y:[0],
                             marker: {size: 28, color:'850000'},
                             showlegend: false,
                             name: '%',
                             text: {!promedioCoeDesarrollo},//level,
                             hoverinfo: 'text+name'},
                            { values: [50/4, 50/4, 50/4, 50/4, 50],
                             rotation: 90,
                             text: ['75-100 %', '50-75 %', '25-50 %', '0-25 %', ''],
                             textinfo: 'text',
                             textposition:'inside',
                             marker: {colors:['rgba(14, 127, 0, .5)', 'rgba(110, 154, 22, .5)',
                                              'rgba(221, 232, 0, .5)', 'rgba(204, 0, 0, .5)', 'rgba(255, 255, 255, 0.1)']},
                             labels: ['75-100 %', '50-75 %', '25-50 %', '0-25 %','Coeficiente de desarrollo de territorio'],
                             hoverinfo: 'label',
                             hole: .5,
                             type: 'pie',
                             showlegend: false
                            }];
                
                var layout = {
                    shapes:[{
                        type: 'path',
                        path: path,
                        fillcolor: '850000',
                        line: {
                            color: '850000'
                        }
                    }],
                    title: '{!$Label.Coeficiente_de_Desarrollo_de_Territorio}',
                    height: 450,
                    width: 450,
                    xaxis: {zeroline:false, showticklabels:false,
                            showgrid: false, range: [-1, 1],fixedrange: true},
                    yaxis: {zeroline:false, showticklabels:false,
                            showgrid: false, range: [-1, 1],fixedrange: true}
                };
                
                Plotly.newPlot('myDiv', data, layout, {displayModeBar: true, displaylogo: false, showlegend: false, modeBarButtonsToRemove: ['resetScale2d','hoverClosestCartesian','zoomOut2d','zoomIn2d','pan2d','toImage','sendDataToCloud','zoom2d','select2d','lasso2d','hoverClosestCartesian','hoverCompareCartesian','autoScale2d'] });
                </script>
                
                <!-- segundo grafico promedio simple -->
                
                <div id="promedioSimple" style="width:33%;height: 450px; margin-bottom: -180px;position:relative;z-index:0;margin-left: 0%;float:left;"></div>
                
                <script>
                // Enter a speed between 0 and 180
                var level = 175;
                
                // Trig to calc meter point
                var degrees = ((100-{!promedioCompletitud})*90)/50,
                    radius = .5;
                var radians = degrees * Math.PI / 180;
                var x = radius * Math.cos(radians);
                var y = radius * Math.sin(radians);
                
                // Path: may have to change to create a better triangle
                var mainPath = 'M -.0 -0.025 L .0 0.025 L ',
                    pathX = String(x),
                    space = ' ',
                    pathY = String(y),
                    pathEnd = ' Z';
                var path = mainPath.concat(pathX,space,pathY,pathEnd);
                
                var data = [{ type: 'scatter',
                             x: [0], y:[0],
                             marker: {size: 28, color:'850000'},
                             showlegend: false,
                             name: '%',
                             text: {!promedioCompletitud},//level,
                             hoverinfo: 'text+name'},
                            { values: [50/4, 50/4, 50/4, 50/4, 50],
                             rotation: 90,
                             text: ['75-100 %', '50-75 %', '25-50 %', '0-25 %', ''],
                             textinfo: 'text',
                             textposition:'inside',
                             marker: {colors:['rgba(14, 127, 0, .5)', 'rgba(110, 154, 22, .5)',
                                              'rgba(221, 232, 0, .5)', 'rgba(204, 0, 0, .5)', 'rgba(255, 255, 255, 0.1)']},
                             labels: ['75-100 %', '50-75 %', '25-50 %', '0-25 %','Coeficiente de desarrollo de territorio'],
                             hoverinfo: 'label',
                             hole: .5,
                             type: 'pie',
                             showlegend: false
                            }];
                
                var layout = {
                    shapes:[{
                        type: 'path',
                        path: path,
                        fillcolor: '850000',
                        line: {
                            color: '850000'
                        }
                    }],
                    title: '{!$Label.Promedio_Completitud_de_Cuestionario}',
                    height: 450,
                    width: 450,
                    xaxis: {zeroline:false, showticklabels:false,
                            showgrid: false, range: [-1, 1],fixedrange: true},
                    yaxis: {zeroline:false, showticklabels:false,
                            showgrid: false, range: [-1, 1],fixedrange: true}
                };
                
                Plotly.newPlot('promedioSimple', data, layout, {displayModeBar: true, displaylogo: false, showlegend: false, modeBarButtonsToRemove: ['resetScale2d','hoverClosestCartesian','zoomOut2d','zoomIn2d','pan2d','toImage','sendDataToCloud','zoom2d','select2d','lasso2d','hoverClosestCartesian','hoverCompareCartesian','autoScale2d'] });
                </script>
            </apex:outputPanel>
            <!-- tercer grafico promedio de cuentas con fourPlanning creados -->
            
            
            <div id="promedioDe4PlanningCreados" style="width:33%;height: 450px; margin-bottom: -180px;position:relative;z-index:0;margin-left: 66%;"></div>
            
            <script>
            // Enter a speed between 0 and 180
            var level = 175;
            
            // Trig to calc meter point
            var degrees = ((100-{!promedioCuentasConFourPlanning})*90)/50,
                radius = .5;
            var radians = degrees * Math.PI / 180;
            var x = radius * Math.cos(radians);
            var y = radius * Math.sin(radians);
            
            // Path: may have to change to create a better triangle
            var mainPath = 'M -.0 -0.025 L .0 0.025 L ',
                pathX = String(x),
                space = ' ',
                pathY = String(y),
                pathEnd = ' Z';
            var path = mainPath.concat(pathX,space,pathY,pathEnd);
            
            var data = [{ type: 'scatter',
                         x: [0], y:[0],
                         marker: {size: 28, color:'850000'},
                         showlegend: false,
                         name: '%',
                         text: {!promedioCuentasConFourPlanning},//level,
                         hoverinfo: 'text+name'},
                        { values: [50/4, 50/4, 50/4, 50/4, 50],
                         rotation: 90,
                         text: ['75-100 %', '50-75 %', '25-50 %', '0-25 %', ''],
                         textinfo: 'text',
                         textposition:'inside',
                         marker: {colors:['rgba(14, 127, 0, .5)', 'rgba(110, 154, 22, .5)',
                                          'rgba(221, 232, 0, .5)', 'rgba(204, 0, 0, .5)', 'rgba(255, 255, 255, 0.1)']},
                         labels: ['75-100 %', '50-75 %', '25-50 %', '0-25 %','Coeficiente de desarrollo de territorio'],
                         hoverinfo: 'label',
                         hole: .5,
                         type: 'pie',
                         showlegend: false
                        }];
            
            var layout = {
                shapes:[{
                    type: 'path',
                    path: path,
                    fillcolor: '850000',
                    line: {
                        color: '850000'
                    }
                }],
                title: '{!$Label.Clientes_con_4Plannning}',
                height: 450,
                width: 450,
                xaxis: {zeroline:false, showticklabels:false,
                        showgrid: false, range: [-1, 1],fixedrange: true},
                yaxis: {zeroline:false, showticklabels:false,
                        showgrid: false, range: [-1, 1],fixedrange: true}
            };
            
            Plotly.newPlot('promedioDe4PlanningCreados', data, layout, {displayModeBar: true, displaylogo: false, showlegend: false, modeBarButtonsToRemove: ['resetScale2d','hoverClosestCartesian','zoomOut2d','zoomIn2d','pan2d','toImage','sendDataToCloud','zoom2d','select2d','lasso2d','hoverClosestCartesian','hoverCompareCartesian','autoScale2d'] });
            </script>
        </div>
        <!-- FIN GRAFICOS -->
        
        <!-- Tabla de clientes -->
        <apex:outputpanel style="background-color:white;z-index:1;position:relative" styleClass="container-fluid bootstrap-sf1" id="Content">
            
            <div id="separador" class="separador"></div>
            <br/>
            
            <apex:commandButton id="guiaDeUso" action="{!irAGuiaDeUso}" style="float:left; margin-top:-315px;  margin-left:24%" styleClass="btn btn-primary btn-sm pull-left"
                                value="Guía de Uso" onclick="irAGuiaDeUso();" />

            <button style="float:left; margin-left:33%;  margin-top:-315px" type="button" class="btn btn-primary btn-sm pull-left" data-toggle="modal" data-target="#modalIncidencia">
                Reporte de Incidencias
            </button>
            
            <button style="float:left; margin-left:47%;  margin-top:-315px" type="button" class="btn btn-primary btn-sm pull-left" onclick="abrirCobertura();">
                Cobertura del Portfolio
            </button>
            <button style="margin-left:61%;  margin-top:-315px" type="button" class="btn btn-primary btn-sm pull-left" onclick="abrirVencimientos();">
                Vencimientos (Total Cartera)
            </button>
            
<br/>
            <!-- FILTROS -->
            
            
            
            <div id="filterDiv">
                <!-- primer filtro tiene fourPlanning -->
                <apex:outputText style="width:12%" value="{!$Label.certa_scp__filtrar_clientes}"/>
                <span id="field1Span">
                    <apex:selectList value="{!filtro1Valor}" size="1">
                        <apex:selectOption itemValue="ninguno" itemLabel="{!$Label.certa_scp__todos}"/>
                        <apex:selectOption itemValue="true" itemLabel="{!$Label.certa_scp__con_4planning}"/>
                        <apex:selectOption itemValue="false" itemLabel="{!$Label.certa_scp__sin_4planning}"/>
                    </apex:selectList>
                </span>
                <div style="width: 10px;float: left;"></div>
                
                <br/>
                <div style="width: 10px;height: 5px"></div>
                <br/>
                
                <!-- segundo filtro -->
                <apex:outputPanel styleClass="filtrosSiBuscaConFourPlanning">
                    <!--<apex:outputText value="{!$Label.certa_scp__filtro}:"/>
                    <div style="width: 10px;float: left;"></div>
                    
                    <!--Primer Filtro
                    
                    <span id="field2Span">
                        <apex:selectList value="{!filtro2Parametro}" size="1">
                            <apex:selectOption itemValue="ninguno" itemLabel="{!$Label.certa_scp__ninguno}"/>
                            <apex:selectOption itemValue="conocimiento_de_la_cuenta__c" itemLabel="{!$Label.certa_scp__desarrollo_de_cuenta}"/>
                            <apex:selectOption itemValue="Porcentaje_de_completitud_de_la_cuenta__c" itemLabel="{!$Label.certa_scp__cuestionario_completo}"/>
                        </apex:selectList>
                    </span>
                    
                    <span id="operator2Span">
                        <apex:selectList value="{!filtro2Operacion}" size="1">
                            <apex:selectOption itemValue="ninguno" itemLabel="{!$Label.certa_scp__ninguno}"/>
                            <apex:selectOption itemValue="=" itemLabel="{!$Label.certa_scp__igual_a}"/>
                            <apex:selectOption itemValue="!=" itemLabel="{!$Label.certa_scp__distinto_a}"/>
                            <apex:selectOption itemValue="<" itemLabel="{!$Label.certa_scp__menor_a}"/>
                            <apex:selectOption itemValue="<=" itemLabel="{!$Label.certa_scp__menor_igual_a}"/>
                            <apex:selectOption itemValue=">" itemLabel="{!$Label.certa_scp__mayor_a}"/>
                            <apex:selectOption itemValue=">=" itemLabel="{!$Label.certa_scp__mayor_igual_a}"/>
                        </apex:selectList>
                    </span>
                    
                    <span id="value2Span">
                        <apex:input style="height: 21px;position:relative;top:-1px" value="{!filtro2Valor}" />
                    </span>
                    
                    
                    <apex:selectList value="{!conectorLogico2}" size="1">
                        <apex:selectOption itemValue="AND" itemLabel="{!$Label.certa_scp__and}"/>
                        <apex:selectOption itemValue="OR" itemLabel="{!$Label.certa_scp__or}"/>
                    </apex:selectList>
                    
                    <div style="width: 10px;float: left;"></div>
                    <span id="2Span" class="removeSpan" >{!$Label.Remove}</span>
                    <br/>
                    <div style="width: 10px;height: 5px"></div>
                    
                    <!-- tercer filtro  
                    
                    <apex:outputText value="{!$Label.certa_scp__filtro} 2:"/>
                    <div style="width: 10px;float: left;"></div>
                    
                    <span id="field3Span">
                        <apex:selectList value="{!filtro3Parametro}" size="1">
                            <apex:selectOption itemValue="ninguno" itemLabel="{!$Label.certa_scp__ninguno}"/>
                            <apex:selectOption itemValue="conocimiento_de_la_cuenta__c" itemLabel="{!$Label.certa_scp__desarrollo_de_cuenta}"/>
                            <apex:selectOption itemValue="Porcentaje_de_completitud_de_la_cuenta__c" itemLabel="{!$Label.certa_scp__cuestionario_completo}"/>
                        </apex:selectList>
                    </span>
                    
                    <span id="operator3Span">
                        <apex:selectList value="{!filtro3Operacion}" size="1">
                            <apex:selectOption itemValue="ninguno" itemLabel="{!$Label.certa_scp__ninguno}"/>
                            <apex:selectOption itemValue="=" itemLabel="{!$Label.certa_scp__igual_a}"/>
                            <apex:selectOption itemValue="!=" itemLabel="{!$Label.certa_scp__distinto_a}"/>
                            <apex:selectOption itemValue="<" itemLabel="{!$Label.certa_scp__menor_a}"/>
                            <apex:selectOption itemValue="<=" itemLabel="{!$Label.certa_scp__menor_igual_a}"/>
                            <apex:selectOption itemValue=">" itemLabel="{!$Label.certa_scp__mayor_a}"/>
                            <apex:selectOption itemValue=">=" itemLabel="{!$Label.certa_scp__mayor_igual_a}"/>
                        </apex:selectList>
                    </span>
                    
                    <span id="value3Span">
                        <apex:input style="height: 21px;position:relative;top:-1px" value="{!filtro3Valor}" />
                    </span>
                    
                    <apex:selectList value="{!conectorLogico3}" size="1">
                        <apex:selectOption itemValue="AND" itemLabel="{!$Label.certa_scp__and}"/>
                        <apex:selectOption itemValue="OR" itemLabel="{!$Label.certa_scp__or}"/>
                    </apex:selectList>
                    
                    <div style="width: 10px;float: left;"></div>
                    <span id="3Span" class="removeSpan" >{!$Label.Remove}</span>
                    <br/>
                    <div style="width: 10px;height: 5px"></div>
                    
                    <!-- cuarto filtro -->
                    
                    <apex:outputText value="{!$Label.certa_scp__filtro}:"/>
                    <div style="width: 10px;float: left;"></div>
                    
                    <span id="field4Span">
                        <apex:selectList value="{!filtro4Parametro}" size="1">
                            <apex:selectOption itemValue="ninguno" itemLabel="{!$Label.certa_scp__ninguno}"/>
                            <apex:selectOption itemValue="conocimiento_de_la_cuenta__c" itemLabel="{!$Label.certa_scp__desarrollo_de_cuenta}"/>
                            <apex:selectOption itemValue="Porcentaje_de_completitud_de_la_cuenta__c" itemLabel="{!$Label.certa_scp__cuestionario_completo}"/>
                        </apex:selectList>
                    </span>
                    
                    <span id="operator4Span">
                        <apex:selectList value="{!filtro4Operacion}" size="1">
                            <apex:selectOption itemValue="ninguno" itemLabel="{!$Label.certa_scp__ninguno}"/>
                            <apex:selectOption itemValue="=" itemLabel="{!$Label.certa_scp__igual_a}"/>
                            <apex:selectOption itemValue="!=" itemLabel="{!$Label.certa_scp__distinto_a}"/>
                            <apex:selectOption itemValue="<" itemLabel="{!$Label.certa_scp__menor_a}"/>
                            <apex:selectOption itemValue="<=" itemLabel="{!$Label.certa_scp__menor_igual_a}"/>
                            <apex:selectOption itemValue=">" itemLabel="{!$Label.certa_scp__mayor_a}"/>
                            <apex:selectOption itemValue=">=" itemLabel="{!$Label.certa_scp__mayor_igual_a}"/>
                        </apex:selectList>
                    </span>
                    
                    <span id="value4Span">
                        <apex:input style="height: 21px;position:relative;top:-1px" value="{!filtro4Valor}" />
                    </span>
                    
                    <div style="width: 10px;float: left;"></div>
                    <span id="4Span" class="removeSpan" >{!$Label.Remove}</span>
                    <br/>
                    <div style="width: 10px;height: 5px"></div>
                    <br/>    
                </apex:outputPanel> 
                
                <apex:outputPanel id="filtros">
                <!-- filtrar por nombre -->
                <apex:outputText style="width:12%" value="{!$Label.certa_scp__filtrar_por_cliente}: " />
                    <apex:input id="campoNombre" value="{!filtroDeNombre}" onkeydown="if(event.keyCode==13){this.blur();doSearchAF();}" />
					                    
				
                    
                    
                    
                    <!-- sector y sub sector -->
                    &nbsp;
                    <apex:outputText style="width:12%" value="{!$Label.certa_scp__sector}: " />
                    <apex:inputField value="{!filtro.Sector__c}" />&nbsp;
                    <apex:outputText style="width:12%" value="{!$Label.certa_scp__sub_sector}: " />
                    <apex:inputField value="{!filtro.Sub_sector__c}" />
                    
                <br/>
                <div style="width: 10px;height: 5px"></div>
                <br/>
                
                
                <apex:outputText style="width:12%;" value="{!$Label.certa_scp__filtrar_por_comercial}: " />
                &nbsp;
                <button type="button" class="btn btn-default btn-sm" data-toggle="modal" data-target="#myModalFiltroUsr">
                    <span class="glyphicon glyphicon-search"></span>
                </button>
                
                <br/><br/>
                
                <apex:commandButton styleClass="btn btn-default btn-sm" onkeypress="" action="{!filtrar}" value="{!$Label.certa_scp__obtener_clientes}" id="theButton" oncomplete="colorearLineaDeTiempo();" rerender="listaDeClientes, timeLine, panelesDeLineaDeTiempo, filtrosDeLineTime, imagenes, graficosARenderizar" status="filtrarClientesStatus" />
                <apex:actionFunction name="doSearchAF" action="{!filtrar}" rerender="listaDeClientes, timeLine, panelesDeLineaDeTiempo, filtrosDeLineTime, imagenes, graficosARenderizar" />
                <apex:actionFunction name="abrirCobertura" action="{!irACobertura}" />
                <apex:actionFunction name="abrirVencimientos" action="{!irAVencimientos}" />
                    
                    <apex:actionStatus id="filtrarClientesStatus">
                        
                        <apex:facet name="start">
                            <img src="/img/loading.gif"/>
                        </apex:facet>
                    </apex:actionStatus>
                <!-- oncomplete="createDataTableSerch()"/ -->
                
                </apex:outputPanel>
                </div>
                <!-- fin filtros -->

            <br/><br/>
            
            <!-- tabla de clientes -->
            <apex:outputPanel style="background-color: white" id="listaDeClientes">
                
                
                <span style="float: left;font-weight: bold;">{!$Label.Clientes}</span>
                <table id="mainOppsTable" class="table table-striped table-bordered table-condensed dataTablePrincipal" style="width: 100%;">
                    <thead>
                        <tr class="headerRow">                              
                            <th scope="col" class=" deemphasize" style="vertical-align:top;">{!$Label.Nombre_del_cliente}</th>
                            <th scope="col" class=" deemphasize" style="vertical-align:top;">Propietario de la Cuenta</th>
                            <th scope="col" class=" deemphasize" style="vertical-align:top;">{!$Label.Tiene_4_Planning}</th>
                            <th scope="col" class=" deemphasize" style="vertical-align:top;">{!$Label.Coeficiente_d_Desarrollo_de_cuenta_porciento}</th>
                            <th scope="col" class=" deemphasize" style="vertical-align:top;">{!$Label.Cuestionario_completo_al_porciento}</th>
                            <th scope="col" class=" deemphasize" style="width:12%;white-space: normal;">{!$Label.Cuestionario}</th>
                        </tr>
                    </thead>
                    <tbody>
                        
                        <apex:repeat value="{!CuentasSetController}" var="cuenta" id="necesidadSectorial">
                            <tr>
                                <td class="dataCell">
                                    {!cuenta.name}
                                </td>
                                <td class="dataCell">
                                    {!cuenta.Owner.name}
                                </td>
                                <td class="dataCell">
                                    <apex:repeat value="{!cuenta.FourPlannings__r}" var="fplanning"> 
                                        <apex:outputPanel rendered="{!fplanning.id != null}">
                                            <apex:outputPanel rendered="{!fplanning.Porcentaje_de_completitud_de_la_cuenta__c != null}">
                                                <apex:outputPanel rendered="{!fplanning.Porcentaje_de_completitud_de_la_cuenta__c > 0}">
                                                <img src="/img/checkbox_checked.gif" alt="Seleccionado" width="16" height="16" class="checkImg" id="cpn16_chkbox" title="Seleccionado"/>
                                                </apex:outputPanel>
                                            </apex:outputPanel>
                                        </apex:outputPanel>
                                    </apex:repeat>
                                </td>
                                <td class="dataCell">
                                    <apex:repeat value="{!cuenta.FourPlannings__r}" var="fplanning"> 
                                        {!fplanning.conocimiento_de_la_cuenta__c}
                                    </apex:repeat>
                                </td>
                                <td class="dataCell">
                                    <apex:repeat value="{!cuenta.FourPlannings__r}" var="fplanning"> 
                                        {!fplanning.Porcentaje_de_completitud_de_la_cuenta__c}
                                    </apex:repeat>
                                </td>
                                <td class="dataCell" style="width: 10%;">
                                    <apex:outputLink value="/apex/InformacionDeLaCuenta?id={!cuenta.id}">{!$Label.certa_scp__ir_al_cuestionario}</apex:outputLink>
                                </td>
                                <!--<td class="dataCell" style="width: 10%;">
                                    <apex:outputLink value="/apex/ejesdetrabajo?id={!cuenta.id}">{!$Label.certa_scp__ir_a_ejes_de_trabajo}</apex:outputLink>
                                </td>
                                <td class="dataCell" style="width: 10%;">
                                    <apex:outputLink value="/apex/desarrollocuenta?id={!cuenta.id}">{!$Label.certa_scp__ir_a_desarrollo_cuenta}</apex:outputLink>
                                </td>-->
                            </tr>
                        </apex:repeat>
                        
                    </tbody>
                </table>
                
                <div class="btn-group pull-right" role="group" aria-label="...">
                    <b>{!$Label.Pagina_dos_puntos} {!numeroDePagina} {!$Label.de} {!paginasTotales} &nbsp;</b>    
                    <div class="btn-group pull-right" role="group" aria-label="...">
                        <apex:commandButton disabled="{!numeroDePagina == 1}" oncomplete="renderizarLineaDeTiempoConDatosActuales();" styleClass="btn btn-default btn-xs" action="{!obtenerPrimerPagina}" value="{!$Label.certa_scp__primera}" id="Primera"  rerender="filtrosDeLineTime" status="cambiarDePagina"/>
                        <apex:commandButton disabled="{!numeroDePagina == 1}" oncomplete="renderizarLineaDeTiempoConDatosActuales();" styleClass="btn btn-default btn-xs" action="{!obtenerAnterior}" value="{!$Label.certa_scp__anterior}" id="anterior"  rerender="filtrosDeLineTime" status="cambiarDePagina"/>
                        <apex:commandButton disabled="{!numeroDePagina == paginasTotales}" oncomplete="renderizarLineaDeTiempoConDatosActuales();" styleClass="btn btn-default btn-xs" action="{!obtenerSiguiente}" value="{!$Label.certa_scp__siguiente}" id="siguiente"  rerender="filtrosDeLineTime" status="cambiarDePagina"/>
                        <apex:commandButton disabled="{!numeroDePagina == paginasTotales}" oncomplete="renderizarLineaDeTiempoConDatosActuales();" styleClass="btn btn-default btn-xs" action="{!obtenerUltimaPagina}" value="{!$Label.certa_scp__ultima}" id="Ultima"  rerender="filtrosDeLineTime" status="cambiarDePagina" />
                    </div>
                </div>
                
                <apex:actionStatus id="cambiarDePagina" styleClass="pull-right">
                    <apex:facet name="start">
                        <img src="/img/loading.gif"/>
                    </apex:facet>
                </apex:actionStatus>
                <br/>
                
            </apex:outputPanel>
            
            <script>
            function iniciarDataTable(){
                
                $j('#mainOppsTable').DataTable({
                    "bPaginate": false,        
                    "bInfo": false,
                    "bFilter": false,
                    "columns": [
                        null,
                        null,
                        null,
                        null,
                        null,
                        { "width": "13%" }
                    ],
                        "language": {
                        "search": "{!$Label.Buscar} ",
                        "sEmptyTable": "{!$Label.No_hay_clientes_cargados}",
                        "zeroRecords": "{!$Label.No_hay_clientes_que_coincidan_con_el_criterio_de_busqueda}"
                        }
                        });
                        
                        }
                        </script>
            <!-- FIN TABLA CLIENTES-->
            
            <!-- linea de tiempo --> 
            <br/>
            <apex:outputPanel id="filtrosDeLineTime">
                <div class="alert alert-info" role="alert">	
                    <span class="glyphicon glyphicon-info-sign"></span>	    				
                    <span class="messageText colorSpanReferencias"><span class="colorSpanReferencias" style="font-weight:bold;  margin:5px">{!$Label.Asignaci_n_de_Eventos}</span>
                        <span class="colorSpanReferencias" style="margin-left:3px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                        <span class="colorSpanReferencias">{!$Label.certa_scp__todos}</span>&nbsp;<apex:inputCheckbox styleClass="todos" value="{!todos}" onclick="marcarTodas(this, 'checkboxFiltroTimeLine')" /><br/>
                        
                        <div class="row">
                            <div class= "col-md-4 colorSpanReferencias">
                                <span class="colorVencimiento" style="margin-left:3px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                                <span class="colorSpanReferencias">{!$Label.Vencimiento}</span>&nbsp;<apex:inputCheckbox styleClass="checkboxFiltroTimeLine" value="{!filtroVencimiento}" /><br/>
                                <span class="colorReto" style="margin-left:3px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                                <span class="colorSpanReferencias">{!$Label.Reto}</span>&nbsp;<apex:inputCheckbox styleClass="checkboxFiltroTimeLine" value="{!filtroEventosDeTipoReto}" /><br/>
                                <span class="colorVencimientoSecundario" style="margin-left:3px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                                <span class="colorSpanReferencias">{!$Label.Vencimiento_Contrato_Activo_con_la_Competencia}</span>&nbsp;<apex:inputCheckbox styleClass="checkboxFiltroTimeLine" value="{!filtroVencimientoCompetencia}" /><br/>
                            </div>
                            
                            <div class= "col-md-4 colorSpanReferencias"> 
                                <span class="clientes" style="margin-left:3px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                                <span class="colorSpanReferencias">{!$Label.Evento_Telef_nica}</span>&nbsp;<apex:inputCheckbox styleClass="checkboxFiltroTimeLine" value="{!filtroEventoTelefonica}" /><br/>
                                <span class="eventoRelevante" style="margin-left:3px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                                <span class="colorSpanReferencias">{!$Label.Evento_Relevante_de_la_industria}</span>&nbsp;<apex:inputCheckbox styleClass="checkboxFiltroTimeLine" value="{!filtroEventoIndustria}" /><br/>
                            </div>
                            
                            <div class= "col-md-4 colorSpanReferencias">
                                <span class="RFPComunicaciones" style="margin-left:3px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                                <span class="colorSpanReferencias">{!$Label.Publicaci_n_RFP_Comunicaciones}</span>&nbsp;<apex:inputCheckbox styleClass="checkboxFiltroTimeLine" value="{!filtroPublicacionRFPComunicacion}" /><br/>
                                <span class="RFPTI" style="margin-left:3px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                                <span class="colorSpanReferencias">{!$Label.Publicaci_n_RFP_TI}</span>&nbsp;<apex:inputCheckbox styleClass="checkboxFiltroTimeLine" value="{!filtroPublicacionRFPTI}" /><br/> 
                                <span class="colorOtros" style="margin-left:3px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                                <span class="colorSpanReferencias">{!$Label.Otros}</span>&nbsp;<apex:inputCheckbox styleClass="checkboxFiltroTimeLine" value="{!filtroOtroTipoDeEvento}" /><br/>
                            </div>
                        </div>
                        
                    </span>
                </div>
            </apex:outputPanel>
            
            <apex:commandButton styleClass="btn btn-default btn-xs " action="{!filtrarTimeLine}" value="{!$Label.certa_scp__apply_filters}" rerender="panelesDeLineaDeTiempo, timeLine, filtrosDeLineTime" oncomplete="colorearLineaDeTiempo();" status="filtrarTimeLineStatus" />
            
            <apex:actionStatus id="filtrarTimeLineStatus">
                <apex:facet name="start">
                    <img src="/img/loading.gif"/>
                </apex:facet>
            </apex:actionStatus>
            
            <br/>
            
            <apex:outputPanel id="panelesDeLineaDeTiempo"> 
                <apex:outputPanel rendered="{! !mostrarLineaDeTiempo}">
                    <br/>
                    <div style = "width: 98%;" class="center-block alert alert-warning" role="alert">
                        <span class="glyphicon glyphicon-warning-sign" aria-hidden="true"></span>
                        {!$Label.No_hay_eventos_a_mostrar_en_los_clientes_seleccionados}
                    </div>
                    
                </apex:outputPanel>
                
                <apex:outputPanel id="timeLine" rendered="{!mostrarLineaDeTiempo}">
                    <div id='timeline-embed' style="width: 100%; height: 430px"></div>
                    <script type="text/javascript">
                    
                    var timeline_json = {!miJson};
                    
                    var options = {
                        hash_bookmark: false,
                        language: "es",
                        scale_factor: -50,
                        start_at_slide: 1,
                        initial_zoom: 1
                    }
                    
                    window.timeline = new TL.Timeline('timeline-embed',
                                                      timeline_json, options);
                    window.timeline.setZoom(0); 
                    </script>
                </apex:outputPanel>
            </apex:outputPanel>
            
            
            <apex:outputPanel id="imagenes">
                <div id="separador" class="separador"></div>
                <br/>
                <h3 style="margin-left: 2%;text-decoration: underline;">
                    {!$Label.Desarrollo_de_Cartera}
                </h3>
                
                <apex:outputText value="{!$Label.certa_scp__moneda}: "/>
                <apex:inputField value="{!filtro.Moneda_Grafico_Esferas__c}" label="{!$Label.certa_scp__moneda_del_grafico}" />
                <br/><br/>
                <apex:commandButton styleClass="btn btn-default btn-xs" action="{!filtrar}" value="{!$Label.certa_scp__actualizar_moneda}" rerender="imagenes, graficosARenderizar" />
                
                <div id="desarrolloCuenta" style="width: 100%; height: 500px;"></div>
                
                
                <script>
                var trace1 = {
                    x: [90],
                    y: [{!alturaNombre}],
                    text: ['{!$Label.Zona_Objetivo}'],
                    textfont: {
                        family: 'sans serif',
                        size: 16,
                        color: 'balck'
                    },
                    mode: 'text',
                    name: '{!$Label.Referencias}'
                };
                
                var trace3 = {
                    x: [{!primerQ.ejeX}, {!segundoQ.ejeX}, {!tercerQ.ejeX}, {!ultimoQ.ejeX}],
                    y: [{!primerQ.ejeY}, {!segundoQ.ejeY}, {!tercerQ.ejeY}, {!ultimoQ.ejeY}],
                    mode: 'markers+text',
                    marker: {
                        color: ['rgba(204, 0, 0, 0.84)', 'rgba(13, 109, 2, 0.84)',  'rgb(242, 207, 91)', 'rgb(11, 40, 74)'],
                        opacity: [0.8, 0.8, 0.8, 0.8],
                        size: [{!primerQ.valorParaGraficarseEnPixeles}, {!segundoQ.valorParaGraficarseEnPixeles}, {!tercerQ.valorParaGraficarseEnPixeles},{!ultimoQ.valorParaGraficarseEnPixeles}]
                    },
                    text: ['', '', '', ''],
                    textfont: {
                        family: 'sans serif',
                        size: 16,
                        color: '#fff'
                    },
                    type: 'scatter',
                    name: '{!$Label.Bolas}'
                };
                
                //var data = [trace1, trace3];
                var data = [trace1, trace3];
                var layout = {
                    xaxis: {
                        title: '{!$Label.Coeficiente_de_Desarrollo_de_Cartera} (%)',
                        autotick: false,
                        ticks: 'outside',
                        tick0: 0,
                        dtick: 10,
                        ticklen: 4,
                        tickwidth: 2,
                        tickcolor: '#000',
                        range: [0, 100]
                        
                    },
                    yaxis: {
                        title: '{!$Label.Ventas_Nav}',
                        autotick: true,//antes estaba como false
                        ticks: 'outside',
                        //tick0: 0,
                        //dtick: 10,
                        ticklen: 4,
                        tickwidth: 2,
                        tickcolor: '#000',
                        //range: [0,20]
                        
                        
                    },
                    shapes: [
                        
                        //Rectangulo
                        
                        {
                            type: 'rect',
                            xref: 'x',
                            yref: 'y',
                            x0: {!filtro.Zona_Objetivo_valor_1_eje_x__c},
                            y0: {!filtro.altura_zona_objetivo_minima__c},
                            x1: {!filtro.Zona_Objetivo_valor_2_eje_x__c},
                            y1: {!filtro.altura_zona_objetivo_maxima__c},
                            line: {
                                color: 'rgb(55, 128, 191)',
                                width: 3
                            },
                            fillcolor: 'rgba(55, 128, 191, 0.6)'
                        }
                    ]
                    
                };
                Plotly.newPlot('desarrolloCuenta', data, layout, {displayModeBar: true, displaylogo: false, showlegend: false, modeBarButtonsToRemove: ['toImage','sendDataToCloud','zoom2d','select2d','lasso2d','hoverClosestCartesian','hoverCompareCartesian','autoScale2d'] });
                //'toImage',
                </script>
                
                <!-- panel de balores de las q -->
                <br/>
                <apex:outputPanel id="valoresQ">
                    <div style="font-style: oblique;font-size: 13px;" class="pull-right">
                        {!$Label.Tama_o_Bola_Tama_o_Funnel}
                        <p>
                            
                        </p>
                        <P>

                                {!primerQ.nombre} {!$Label.Rojo_parentesis} = {!nombreDiametroQ1} ({!filtro.Moneda_Grafico_Esferas__c})
                        </P>
                        <p>

                                {!segundoQ.nombre} {!$Label.Verde_parentesis} = {!nombreDiametroQ2} ({!filtro.Moneda_Grafico_Esferas__c})
                        </p>
                        <p>

                                {!tercerQ.nombre} {!$Label.Amarillo_parentesis} = {!nombreDiametroQ3} ({!filtro.Moneda_Grafico_Esferas__c})
                        </p>
                        <p>

                            {!ultimoQ.nombre} {!$Label.Azul_parentesis} = {!nombreDiametroQ4} ({!filtro.Moneda_Grafico_Esferas__c})
                        </p>
                    </div>
                </apex:outputPanel>
                
                <apex:actionFunction action="{!establecerZonaObjetivo}" name="establecerZonaObjetivo" reRender="imagenes, valoresQ" status="loadingSave" />
                
                <apex:pageBlock title="" mode="maindetail">
                    <apex:pageBlockSection title="{!$Label.certa_scp__establecer_zona_objetivo}" columns="2">
                        
                        <apex:inputField value="{!filtro.altura_zona_objetivo_minima__c}" label="{!$Label.certa_scp__ventas_nav_objetivo_minimo}" />
                        <apex:inputField value="{!filtro.altura_zona_objetivo_maxima__c}" label="{!$Label.certa_scp__ventas_nav_objetivo_maximo}" />
                        
                        <apex:inputField value="{!filtro.Zona_Objetivo_valor_1_eje_x__c}" label="{!$Label.certa_scp__coeficiente_de_desarrollo_de_cuenta_objetivo_minimo}" />
                        
                        <apex:input style="display:none" />
                        <apex:input style="display:none" />
                        <button type="button" style="margin-right: 10px;" class="btn btn-default btn-sm pull-right" onclick="establecerZonaObjetivo()">
                            <span class="glyphicon glyphicon-refresh"></span>&nbsp;{!$Label.Actualizar_Grafico}
                        </button>
                        
                        <div style="position: absolute;right: 25px;">
                            <apex:actionStatus id="loadingSave">
                                <apex:facet name="start">
                                    <img src="/img/loading.gif"/>
                                </apex:facet>
                            </apex:actionStatus>
                        </div>
                        
                    </apex:pageBlockSection>
                </apex:pageBlock>
                
                
            </apex:outputPanel>
            
            <!-- Modal filtro usr -->
            <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog" style="z-index:9999;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title" id="myModalLabel">{!$Label.Usuarios_a_Seleccionar}</h4>
                        </div>
                        
                        <div class="modal-body">
                            
                            
                            <table style="border-collapse: separate;border-spacing: 5px;width:80%;margin-left: 10%;">
                                <thead>
                                    <tr>
                                        <th style="padding-left:0% !important; text-align: center;">{!$Label.Nombre_Usuario}</th>
                                        <th style="padding-left:0% !important; text-align: center;">{!$Label.Seleccionados}</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    
                                    <div class="divConScroll">
                                        <apex:repeat value="{!usersWpp}" var="wppUser" rows="900" >
                                            <tr>
                                                <td style="text-align: center;">
                                                    {!wppUser.nombre}
                                                </td>
                                                <td style="text-align: center;">
                                                    <apex:inputCheckBox value="{!wppUser.seleccionado}" />                                                            
                                                </td>
                                            </tr>
                                        </apex:repeat>
                                    </div>
                                    
                                </tbody>                                          
                            </table>
                            
                        </div>
                        
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">{!$Label.Close}</button>
                            <button type="button" class="btn btn-primary" data-dismiss="modal">{!$Label.Aceptar}</button>
                        </div>
                    </div>
                </div>
            </div>
             
            <!-- Modal filtro usr (usuarios seleccionados manualmente - on demand) 2-->
            <div class="modal fade" id="myModalFiltroUsr" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog" style="z-index:9999;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title" id="myModalLabel">{!$Label.certa_scp__filtrar_por_comercial}</h4>
                        </div>
                        
                        <div class="modal-body">
                            
                            
                            <table style="border-collapse: separate;border-spacing: 5px;width:80%;margin-left: 10%;">
                               <!-- <tr>
                                    <td>
                                        <apex:outputPanel id="gas"> 
                                        <i>*Seleccionar categoria Usuario, para buscar un comercial</i> 
                                        <br />
                                            {!$Label.User_Region}: &nbsp; &nbsp; <apex:inputField id="inputLookUpUsuario" value="{!filtro.UsuarioFiltro__c}"  />
                                        </apex:outputPanel>
                                        <!--<button type="button" styleClass="inputLookupUsuario" class="btn btn-default btn-sm agregarButton" action="agrego()" oncomplete="inputLookUpUsuario();" reRender = "tabla" >
<span class="glyphicon glyphicon-plus icon-btn-left"></span>&nbsp;Agregar
</button>
                                        &nbsp; &nbsp;
                                        <apex:commandButton styleClass="btn btn-default btn-sm" action="{!agrego}" value="{!$Label.certa_scp__add}" oncomplete="inputLookUpUsuario();" reRender="tabla, gas" />
                                        
                                        <br/>
                                        <br/>
                                        
                                    </td>
                                </tr>-->
                                <tr>
                                    <td>   
                                        <apex:outputPanel id="tabla">
                                            <table class="table table-striped table-bordered table-condensed"> 
                                                <thead>
                                                    <tr>
                                                        <th>{!$Label.certa_scp__name}</th>
                                                        <th style="text-align: center;">Seleccionar para poder filtrar</th> 
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <apex:repeat value="{!wrapperUsuarios}" var="usr" rows="900" rendered="{!wrapperUsuarios.size > 0}" >  
                                                        <tr>
                                                            <td >
                                                                {!usr.nombre} &nbsp; &nbsp;
                                                            </td>
                                                            <td style="text-align: center;">
                                                                <apex:inputCheckBox value="{!usr.seleccionado}" />                                                            
                                                            </td>
                                                        </tr>
                                                    </apex:repeat>
                                                </tbody>
                                            </table>  
                                        </apex:outputPanel> 
                                    </td></tr>
                            </table>  
                            
                        </div>

                        <div class="modal-footer">
                            <!--<button type="button" class="btn btn-default" data-dismiss="modal">{!$Label.Close}</button>-->
                            <apex:commandButton styleClass="btn btn-default btn-sm" action="{!seleccionarTodos}" value="Seleccionar Todos" reRender="tabla"  />
                            <apex:commandButton styleClass="btn btn-default btn-sm" action="{!borrarTodos}" value="Borrar Todos" reRender="tabla"  />
                            <button type="button" class="btn btn-primary" data-dismiss="modal">{!$Label.Aceptar}</button>
                            
                            
                        </div>
                        
                    </div>
                </div>
            </div>
            
            
            
            
            
            
            <div class="modal fade" id="modalIncidencia" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog" style="z-index:9999;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title" id="myModalLabel">Reporte de Incidencias</h4>
                        </div>
                        
                        <div class="modal-body">
                            
                            <apex:outputText value="Descripción de la Incidencia/Petición:"></apex:outputText>
                            <apex:inputTextArea styleClass="resetMail" style="width:100%; height:87%;" value="{!cuerpoDeMail}"></apex:inputTextArea>
                           
                            
                        </div>
                        
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">{!$Label.Close}</button>
                            <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="enviarIncidencia();">Enviar</button>
                            <apex:actionFunction action="{!enviarMail}" name="enviarIncidencia" oncomplete="resetCamposMail()" rerender="modalIncidencia"/>  
                    
                        </div>
                    </div>
                </div>
            </div>
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            <!-- 
            <div class="modal fade" id="myModalq1" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog" style="z-index:9999;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title" id="myModalLabel">Oportunidades {!primerQ.nombre}</h4>
                        </div>
                        
                        <div class="modal-body">
                            
                            
                            <table style="border-collapse: separate;border-spacing: 5px;width:80%;margin-left: 10%;">
                                <thead>
                                    <tr>
                                        <th style="padding-left:0% !important; text-align: center;">Ir a</th>
                                        <th style="padding-left:0% !important; text-align: center;">Nombre Oportunidad</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    
                                    <div class="divConScroll">
                                        <apex:repeat value="{!oportunidadesPrimerQ}" var="opp" rows="900">
                                            <tr>
                                                <td style="text-align: center;">
                                                     <apex:outputLink value="/{!opp.id}" target="_blank">Acceder</apex:outputLink>
                                                </td>
                                                <td style="text-align: center;">
                                                    {!opp.name}
                                                </td>
                                            </tr>
                                        </apex:repeat>
                                    </div>
                                    
                                </tbody>                                          
                            </table>
                            
                        </div>
                        
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">{!$Label.Close}</button>
                            <button type="button" class="btn btn-primary" data-dismiss="modal" >Aceptar</button>
                        </div>
                    </div>
                </div>
            </div>
            

            <div class="modal fade" id="myModalq2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog" style="z-index:9999;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title" id="myModalLabel">Oportunidades {!segundoQ.nombre}</h4>
                        </div>
                        
                        <div class="modal-body">
                            
                            
                            <table style="border-collapse: separate;border-spacing: 5px;width:80%;margin-left: 10%;">
                                <thead>
                                    <tr>
                                        <th style="padding-left:0% !important; text-align: center;">Ir a</th>
                                        <th style="padding-left:0% !important; text-align: center;">Nombre Oportunidad</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    
                                    <div class="divConScroll">
                                        <apex:repeat value="{!oportunidadesSegundoQ}" var="opp" rows="900">
                                            <tr>
                                                <td style="text-align: center;">
                                                     <apex:outputLink value="/{!opp.id}" target="_blank">Acceder</apex:outputLink>
                                                </td>
                                                <td style="text-align: center;">
                                                    {!opp.name}
                                                </td>
                                            </tr>
                                        </apex:repeat>
                                    </div>
                                    
                                </tbody>                                          
                            </table>
                            
                        </div>
                        
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">{!$Label.Close}</button>
                            <button type="button" class="btn btn-primary" data-dismiss="modal" >Aceptar</button>
                        </div>
                    </div>
                </div>
            </div>
            

            <div class="modal fade" id="myModalq3" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog" style="z-index:9999;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title" id="myModalLabel">Oportunidades {!tercerQ.nombre}</h4>
                        </div>
                        
                        <div class="modal-body">
                            
                            
                            <table style="border-collapse: separate;border-spacing: 5px;width:80%;margin-left: 10%;">
                                <thead>
                                    <tr>
                                        <th style="padding-left:0% !important; text-align: center;">Ir a</th>
                                        <th style="padding-left:0% !important; text-align: center;">Nombre Oportunidad</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    
                                    <div class="divConScroll">
                                        <apex:repeat value="{!oportunidadesTercerQ}" var="opp" rows="900">
                                            <tr>
                                                <td style="text-align: center;">
                                                     <apex:outputLink value="/{!opp.id}" target="_blank">Acceder</apex:outputLink>
                                                </td>
                                                <td style="text-align: center;">
                                                    {!opp.name}
                                                </td>
                                            </tr>
                                        </apex:repeat>
                                    </div>
                                    
                                </tbody>                                          
                            </table>
                            
                        </div>
                        
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">{!$Label.Close}</button>
                            <button type="button" class="btn btn-primary" data-dismiss="modal" >Aceptar</button>
                        </div>
                    </div>
                </div>
            </div>
            

            <div class="modal fade" id="myModalultimoQ" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog" style="z-index:9999;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title" id="myModalLabel">Oportunidades {!ultimoQ.nombre}</h4>
                        </div>
                        
                        <div class="modal-body">
                            
                            
                            <table style="border-collapse: separate;border-spacing: 5px;width:80%;margin-left: 10%;">
                                <thead>
                                    <tr>
                                        <th style="padding-left:0% !important; text-align: center;">Ir a </th>
                                        <th style="padding-left:0% !important; text-align: center;">Nombre Oportunidad</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    
                                    <div class="divConScroll">
                                        <apex:repeat value="{!oportunidadesUltimoQ}" var="opp" rows="900">
                                            <tr>
                                                <td style="text-align: center;">
                                                    <apex:outputLink value="/{!opp.id}" target="_blank">Acceder</apex:outputLink>
                                                </td>
                                                <td style="text-align: center;">
                                                    {!opp.name}
                                                </td>
                                            </tr>
                                        </apex:repeat>
                                    </div>
                                    
                                </tbody>                                          
                            </table>
                            
                        </div>
                        
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">{!$Label.Close}</button>
                            <button type="button" class="btn btn-primary" data-dismiss="modal" >Aceptar</button>
                        </div>
                    </div>
                </div>
            </div>
            -->
        </apex:outputpanel>
    </apex:form>
</apex:page>