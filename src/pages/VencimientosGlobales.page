<apex:page controller="VencimientosGlobalesController" tabStyle="Strategic_Client_Plan__tab" sidebar="false" showHeader="true" docType="html-5.0" >
    
    <!--<c:FourPlanningMenuSuperiorLocal ></c:FourPlanningMenuSuperiorLocal>-->
    
    <apex:includeScript value="{!URLFOR($Resource.bootstrapSF, 'js/JQueryToBS.js')}"/>
    <apex:includeScript value="{!URLFOR($Resource.bootstrapSF, 'js/bootstrap.min.js')}"/>
	<apex:includeScript value="{!$Resource.JQuery}" />
    <apex:includeScript value="{!$Resource.JQueryUI}"  />
    <apex:includeScript value="{!$Resource.JQueryUITouch}" />
    <apex:includeScript value="{!$Resource.DataTable}"  />
    
    <script>
    	//-----------------------------------------------------------------------------
    	//Add the newer versions with noConflict(true) in reverse load order leaving 1.6.1 first
    	var jq161 = jQuery.noConflict(true);
    	var jq213 = jQuery.noConflict(true);
    	
    	jQuery = jq161;
        //-----------------------------------------------------------------------------
    </script>
	<style>
		.bootstrap-sf1 * {
	    	font-family:  Calibri, ProximaNovaSoft-Regular, 'Helvetica Neue', 'Gill Sans', 'Gill Sans MT', Candara, Segoe, 'Segoe UI', Arial, sans-serif;
	    }
		
		.paddingRight {
			padding-right: 15px;
		}
		
		.inlineEditUndo {
	    	display: none;
	    }
	    
		.inlineEditWriteOn {
		    background: rgba(0, 0, 0, 0) url("/img/func_icons/util/pencil12.gif") no-repeat scroll right 2px;		    
		}
		
		.PopupHolderOpp {
	        float:right;
	        margin-right: 6px;
	        margin: 5px;
	        cursor: pointer;
	    }
	    
	    .PopupHolderOpp *{
	        box-sizing: content-box ! important;
	    }
	    
	    .PopupHolderOpp .pbHeader {
	    	border:0px;
	    	border-top: 3px solid #f3ae4e !important;
	    }
	    
	    .PopupHolderOpp .pbHeader .mainTitle {
	    	font-size: 18px !important;
	    	font-weight: bold !important;	
	    }
	    
	    .PopupHolderOpp .pbBody .labelCol {
	    	font-size: 16px !important;
	    	font-weight: bold !important;	
	    }
	    
	    .PopupHolderOpp .pbBody .dataCol {
	    	font-size: 16px !important;
	    	font-weight: normal !important;
	    }
        
        
        .dropdown-submenu {
        position:relative;
        }
        .dropdown-submenu>.dropdown-menu {
        top:0;
        left:100%;
        margin-top:-6px;
        margin-left:-1px;
        -webkit-border-radius:0 6px 6px 6px;
        -moz-border-radius:0 6px 6px 6px;
        border-radius:0 6px 6px 6px;
        }
        .dropdown-submenu:hover>.dropdown-menu {
        display:block;
        }
        .dropdown-submenu>a:after {
        display:block;
        content:" ";
        float:right;
        width:0;
        height:0;
        border-color:transparent;
        border-style:solid;
        border-width:5px 0 5px 5px;
        border-left-color:#cccccc;
        margin-top:5px;
        margin-right:-10px;
        }
        .dropdown-submenu:hover>a:after {
        border-left-color:#ffffff;
        }
        .dropdown-submenu.pull-left {
        float:none;
        }
        .dropdown-submenu.pull-left>.dropdown-menu {
        left:-100%;
        margin-left:10px;
        -webkit-border-radius:6px 0 6px 6px;
        -moz-border-radius:6px 0 6px 6px;
        border-radius:6px 0 6px 6px;
        }
	</style>
	
	<script>
		jq161 = jQuery.noConflict();
		
		jq161(document).ready(function() {
           jq161(".PopupHolderOpp").live("mouseenter", function(event){
	            if (jq161(this).children(".lookupHoverDetail").css("display") == "none") {
	            	jq161(this).children(".lookupHoverDetail").css("top", event.clientY + 'px');
	    			jq161(this).children(".lookupHoverDetail").css("left",(event.clientX - 360) + 'px');
	    			jq161(this).children(".lookupHoverDetail").css("position","fixed");    		
	            	jq161(this).children(".lookupHoverDetail").show();            	
	    		}
	        });
	        
	        jq161(".PopupHolderOpp").live("mouseleave",function(){
	            jq161(this).children(".lookupHoverDetail").hide();
	        });
        });
	</script>
	  
	<apex:stylesheet value="{!URLFOR($Resource.bootstrapSF, 'css/bootstrap-namespaced.min.css')}"/>	 
	<apex:stylesheet value="{!URLFOR($Resource.bootstrapSF, 'css/BSCustomSyles.css')}"/>
    
    
    <script>
    jQuery.extend( jQuery.fn.dataTableExt.oSort, {
        "date-uk-pre": function ( a ) {
            if (a == null || a == "") {
                return 0;
            }
            var ukDatea = a.split('/');
            return (ukDatea[2] + ukDatea[1] + ukDatea[0]) * 1;
        },
        
        "date-uk-asc": function ( a, b ) {
            return ((a < b) ? -1 : ((a > b) ? 1 : 0));
        },
        
        "date-uk-desc": function ( a, b ) {
            return ((a < b) ? 1 : ((a > b) ? -1 : 0));
        }
    } );
    
    
    jQuery.extend( jQuery.fn.dataTableExt.oSort, {
        "currency-pre": function ( a ) {
            
            console.log(a);
            if(a.includes("EUR") && !a.includes("(EUR")){
                a = (a==="-") ? 0 : a.slice(a.indexOf("EUR")+4, a.indexOf("</span>"));
                a = a.replace(/\./g, "");
                a = a.slice(0, a.indexOf(","));
                console.log("euros");
                console.log(a);
                return a;
            }else{
                
                if(a.includes("(EUR")){
                    a = (a==="-") ? 0 : a.slice(a.indexOf("(EUR")+4, a.indexOf(")"));
                    a = a.replace(/\./g, "");
                    a = a.slice(0, a.indexOf(","));
                    console.log("ars");
                    console.log(a);
                    return a;
                }else{
                    a = (a==="-") ? 0 : a.slice(a.indexOf("$")+1, a.indexOf("</span>"));
                    a = a.replace(/\./g, "");
                    return a;
                }
            }
        },
        
        
        "currency-asc": function ( a, b ) {
            return a - b;
        },
        
        "currency-desc": function ( a, b ) {
            return b - a;
        }
    } );
    
    </script>
    
    <style>
        .pbSubheader h3 {
        display: inline;
        margin-left: 5px;
        font-weight: bold;
        }
        
        .dataTables_filter {
        text-align: right !important;
        }
        
        .separator {
        width: 100%;
        margin-top: 20px;
        }
        
        #big-deal-tab-content th {
        width : 55%;
        text-align : left;
        padding-left : 20%;
        font-size: 14px;
        font-weight: normal;
        }
        
        
        #big-deal-tab-content th label {
        font-size: 14px;
        font-weight: normal;
        }
        
        .icon-sectors {
        width: 90px;            
        }
        
        .icon-sectors-botonera {
        width: 38px;            
        }
        
        #ul-menu-img2 {
        width: 100% ! important;
        border-bottom: 0px solid #cfd0d2;
        
        }
        
        #ul-menu-img2 li {
        text-align: center;
        width: 14.2%;
        height: 185px;
        min-height: 190px;
        max-height: 190px;
        text-transform: none ! important;
        }
        
        #ul-menu-img2 li:hover, #ul-menu-img2 li.active {
        border: 2px solid #539fc6;
        
        }
        
        #ul-menu-img2 li a, #ul-menu-img2 li a:hover {
        border: 0px solid #539fc6 ! important;
        
        }
        
        
        
        
        
        #ul-menu-img {
        width: 100% ! important;
        border-bottom: 0px solid #cfd0d2;
        }
        
        #ul-menu-img li {
        text-align: center;
        width: 16.6%;
        height: 185px;
        min-height: 190px;
        max-height: 190px;
        text-transform: none ! important;
        }
        
        #ul-menu-img li:hover, #ul-menu-img li.active {
        border: 2px solid #539fc6;            
        }
        
        #ul-menu-img li a, #ul-menu-img li a:hover {
        border: 0px solid #539fc6 ! important;
        }
        
        
        .ocultar{
        display:none;
        }
        
        .bordesDeTabla{ 
        border-bottom: 1px solid #ececec;
        border-bottom-width: 1px;
        border-bottom-style: solid;
        }
        
        .tituloLabel{
        text-align: left;
        padding-left: 15% !important;
        }
        
        .esCero{
        background-color: black !important;
        }
        
        .menorDeSetenta{
        background-color:#F1E100 !important;
        }
        
        .menorDeVeinte{
        background-color:#FF0009 !important;
        }
        .menorDeCincuenta{
        background-color:#FF0009 !important;
        }
        
        .completo{
        background-color:#009813 !important;
        }
        
        .casiCompleto{
        background-color:#55C500 !important;
        }
        
        #custom-handle {
        width: 3em;
        height: 1.6em;
        top: 50%;
        margin-top: -.8em;
        text-align: center;
        line-height: 1.6em;
        }
        
        #custom-handle-nosotros {
        width: 3em;
        height: 1.6em;
        top: 50%;
        margin-top: -.8em;
        text-align: center;
        line-height: 1.6em;
        }
        
        #custom-handle-competencia {
        width: 3em;
        height: 1.6em;
        top: 50%;
        margin-top: -.8em;
        text-align: center;
        line-height: 1.6em;
        }
        
        #custom-handle-porcentajeFijo {
        width: 3em;
        height: 1.6em;
        top: 50%;
        margin-top: -.8em;
        text-align: center;
        line-height: 1.6em;
        }
        
        #custom-handle-porcentajeVariable {
        width: 3em;
        height: 1.6em;
        top: 50%;
        margin-top: -.8em;
        text-align: center;
        line-height: 1.6em;
        }
        
        #circle {
        width: 20px;
        height: 20px;
        -webkit-border-radius: 25px;
        -moz-border-radius: 25px;
        border-radius: 25px;
        float:left;
        }
        
        .datePicker {
        z-index: 9999;/*Changed this css property which was 100 prior*/
        position: absolute;
        display: none;
        top: 0;
        left: 0;
        width: 17em;
        background-color: #b7c6b2;
        border-bottom: 1px solid #000;
        border-right: 1px solid #000;
        margin: 0;
        padding: 1px 1px 2px 2px;
        }
        
        .modal-dialog{
        overflow-y: initial !important
        }
        .modal-body{
        height: 250px;
        overflow-y: auto;
        }
        
        
        
        
        
        
        .rTable {
        display: table;
        width: 21%;
        float: left;
        }
        
        .rTable2 {
        display: table;
        width: 47%;
        float: left;
        }
        
        .rTableSoluciones {
        display: table;
        width: 31%;
        float: left;
        }
        .rTableContactos {
        display: table;
        width: 22%;
        
        }
        .rTableRow {
        display: table-row;
        }
        .rTableHeading {
        display: table-header-group;
        background-color: #1a3a54;
        
        }
        
        .rTableHeading2 {
        display: table-header-group;
        background-color: white;
        min-height: 43px;
        
        }
        
        
        .rTableCell {
        background-color: #e2e2f5;
        font-size:14px;
        }
        .rTableCell, .rTableHead {
        display: table-cell;
        padding: 3px 10px;
        border: 1px solid white;
        }
        .rTableHeading {
        display: table-header-group;
        background-color: #1a3a54;
        font-weight: bold;
        }
        .rTableFoot {
        display: table-footer-group;
        font-weight: bold;
        background-color: #ddd;
        }
        .rTableBody {
        display: table-row-group;
        } 
        
        .tituloDeTabla{
        
        color: white;
        font-size: 14px;
        text-align: center;
        height:32px;
        }
        
        .tablaUser {
        /*background-color: #4eb1cb;*/
        background-color: #C1D6D6;
        }
        
        .bordeTablaRetos{
        border-bottom: 2px solid white;
        }
        
        .thVencimiento{
        width: 0 !important; 
        text-align: center !important;
        padding-left: 0 !important; 
        font-size: 14px; 
        font-weight: 900 !important;
        background-color: #1a3a54;
        color: white;
        border-color: white;
        cursor:pointer;
        }
        
    </style>
    
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css"/>
    <link rel="stylesheet" href="/resources/demos/style.css"/>
    <apex:includeScript value="{!$Resource.Ploty}"/>
    
    <!--
<apex:includeScript value="{!$Resource.jquery112}" />

-->
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    
    
    
    
    <script>
        
        $j = jq213; //jQuery.noConflict();
    $j2 = jq161;
    
    $j(document).ready(function() {
        initializeToggles();
        iniciarDataTable();        
        $j( "#tabsNuevos" ).tab();
        
        $j("#" + GetURLParameter("section")).click();        
        //Sliders ========================
        
        //=====================================================================        
        
        
        $j("#" + GetURLParameter("section")).click();
        
        siEstaEnNoDejoVerLaSeccion();
        
        $j(".mostrarCuestionario").change(function(){
            
            siEstaEnNoDejoVerLaSeccion();
            
        }); 
        
        
        $j(".tipoDeContacto").change(function(){
            console.log($j(".tipoDeContacto").val());
            funcion2();
        });
        
        function funcion2(){
            if($j(".tipoDeContacto").val() === 'Otro'){
                $j('.campoContacto').removeClass('ocultar');
            }else{
                $j('.campoContacto').addClass('ocultar');
            }            
        }
        
        
        
        verOtro();
        verPorcentajeFijoYVariable();
        siEstaEnSiSeVeLaFlota();              
        
        $j('.guardar').on('click',function(){
            SaveChanges();
        });
        
        $j(".nivelDeContacto").change(function(){
            if($j(this).val() === 'Otros'){
                $j(".otroNivel").fadeIn();
            }else{
                $j(".otroNivel").fadeOut();
            }
        });
        
        
        $j(".porcentajeFacturacion").change(function(){
            console.log('dentro de cambiar');
            if($j(this).val() > 0){
                $j(".especificarPorcentaje").fadeIn();
            }else{
                $j(".especificarPorcentaje").fadeOut();
            }
        });
        
        
        function iniciarDataTable(){
            
            $j2('#mainOppsTable').dataTable({
                "bPaginate": false,        
                "bInfo": false,
                "aoColumns": [
                    null,
                    null,
                    null,
                    { "sType": "date-uk" },
                    { "sType": "currency" },
                    null
                ],                
                "oLanguage": {
                    "sSearch": "<span>Buscar:</span>",
                    "sEmptyTable": "<span>No hay oportunidades cargadas</span>",
                    "sZeroRecords": "No hay oportunidades que coincidan con el criterio de busqueda",
                    //search
                },
                "language": {
                    "sSearch": "Buscar",
                    "search": "{!$Label.Buscar} ",
                    "sEmptyTable": "No hay oportunidades cargadas",
                    "zeroRecords": "No hay oportunidades que coincidan con el criterio de busqueda"
                }
            });
            
        }
        
        $j(".disponeDeAutomotor").change(function(){
            siEstaEnSiSeVeLaFlota();
        });
        
        $j('#myModalHito').on('shown.bs.modal', function () {
            $j('body').animate({ scrollTop: 0 }, 400);
        });
        
        function siEstaEnNoDejoVerLaSeccion(){
            if($j(".mostrarCuestionario").val() === 'No'){
                $j(".cuestionarioOculto").removeClass('ocultar');    
            }else{
                $j(".cuestionarioOculto").addClass('ocultar');
            }
        }
        
        function siEstaEnSiSeVeLaFlota(){
            console.log($j(".disponeDeAutomotor").val());
            if($j(".disponeDeAutomotor").val() === 'Si'){
                $j('.cuestionarioFlota').removeClass('ocultar');
            }else{
                $j('.cuestionarioFlota').addClass('ocultar');
            }
        }
        
        
        
        $j(".nombreIniciativa").change(function(){
            funcion1();
        });
        
        
        function funcion1(){
            console.log($j(".nombreIniciativa").val());
            if($j(".nombreIniciativa").val() === 'Otro'){
                $j('.campoIniciativa').removeClass('ocultar');
            }else{
                $j('.campoIniciativa').addClass('ocultar');
            }            
        }
        
        
        
        $j(".nombreCategoria").change(function(){
            funcion4();
        });
        
        function funcion4(){
            console.log($j(".nombreCategoria").val());
            if($j(".nombreCategoria").val() === 'Otro'){
                $j('.campoCategoria').removeClass('ocultar');
            }else{
                $j('.campoCategoria').addClass('ocultar');
            }            
        }
        
        $j(".tipoDeContactoEnTabla").click(function(){
            console.log($j(".tipoDeContactoEnTabla").val());
            funcionTabla();
        });
        
        function funcionTabla(){
            console.log($j(".tipoDeContactoEnTabla").val());
            if($j(".tipoDeContactoEnTabla").val() === 'Otro'){
                $j('.campoDeContactoEnTabla').removeClass('ocultar');
            }else{
                $j('.campoDeContactoEnTabla').addClass('ocultar');
            }            
        }
        
        
        
        
        $j(".celdaContenedoraDeActitud").tooltip({ 
            bodyHandler: function() { 
                return $j($j(this).children(".info")).html(); 
            }, 
            showURL: false 
        });
        
        var smallcell = $j(".celdaContenedoraDeActitud").outerWidth();
        
        
        
        $j(".paises").change(function(){
            siEstaEnSiSeVePregunta();
        });
        
        
        function siEstaEnSiSeVePregunta(){
            console.log($j(".paises").val());
            if($j(".paises").val() === 'Si'){
                $j('.cuestionarioPaises').removeClass('ocultar');
            }else{
                $j('.cuestionarioPaises').addClass('ocultar');
            }            
        }
        
    });
    
    
    
    function prueba(){
        console.log($j(".tipoDeContactoEnTabla").val());
        if($j(".tipoDeContactoEnTabla").val() === 'Otro'){
            $j('.campoDeContactoEnTabla').removeClass('ocultar');
        }else{
            $j('.campoDeContactoEnTabla').addClass('ocultar');
        }            
    }
    
    
    
    
    function prueba2(){
        console.log($j(".inputTipo").val());
        if($j(".inputTipo").val() === 'Gestión'){
            $j('.tabla2').removeClass('ocultar');
            $j('.tabla1').addClass('ocultar');
        }else{
            $j('.tabla2').addClass('ocultar');
            $j('.tabla1').removeClass('ocultar');
        } 
        
        if($j(".inputTipo").val() === ''){
            $j('.tabla2').addClass('ocultar');
            $j('.tabla1').addClass('ocultar');
        }
    }
    
    
    
    
    
    
    $j(window).bind('beforeunload', function(){
        return 'saksdk';
    });
    
    function resetCamposHito(){
        
        
        $j('.resetHito').each(function() {
            $j(this).val("");    
        });
        
        $j('.resetReto').each(function() {
            $j(this).val("");    
        });
        
        
        $j('.nosotrosInput').each(function() {
            $j(this).val("");    
        });
        
        $j('.competenciaInput').each(function() {
            $j(this).val("");    
        });
    }
    
    function verOtro(){
        if($j(".nivelDeContacto").val() === 'Otros'){
            $j(".otroNivel").fadeIn();
        }else{
            $j(".otroNivel").fadeOut();
        }
    }
    
    function verPorcentajeFijoYVariable(){
        if($j(".porcentajeFacturacion").val() > 0){
            $j(".especificarPorcentaje").fadeIn();
        }else{
            $j(".especificarPorcentaje").fadeOut();
        }
        
    }
    
    function resetCamposIniciativa(){
        
        $j('.resetIniciativa').each(function() {
            $j(this).val("");    
        });
    }
    
    
    
    function GetURLParameter(sParam) {
        
        var sPageURL = window.location.search.substring(1);
        var sURLVariables = sPageURL.split('&');
        
        for (var i = 0; i < sURLVariables.length; i++) {
            var sParameterName = sURLVariables[i].split('=');
            if (sParameterName[0] == sParam) {
                return sParameterName[1];
            }
        }
    }
    
    function ajaxshow () {
        $j(".ajaxloader").show();
    }
    function ajaxstop () {
        $j(".ajaxloader").hide();
    }
    
    function initializeToggles () {
        var toggle = $j("[id$=reach-defined-checkbox]");
        toggle.click(function () {
            toggleRowClass("reach-file-upload", this.checked);
            toggleRow("reach-file-valoration", this.checked);
        });
        toggleRowClass("reach-file-upload", toggle.is(':checked'));
        toggleRow("reach-file-valoration", toggle.is(':checked'));
        //---------------------------------------------------------------------
        toggle = $j("[id$=reach-similar-projects-exp]");
        toggle.click(function () {
            toggleRow("reach-similar-projects-exp-detail", 
                      $j(this).find('option:selected').val() === "Si");
        });
        toggleRow("reach-similar-projects-exp-detail", toggle.find('option:selected').val() === "Si");
        
        //---------------------------------------------------------------------
        toggle = $j("[id$=reach-technical-checkbox]");
        toggle.click(function () {
            //toggleRow("reach-technical-text", this.checked);
            toggleRowClass("reach-technical-text", this.checked);
            toggleRow("reach-technical-valoration", this.checked);
        });
        //toggleRow("reach-technical-text", toggle.is(':checked'));
        toggleRowClass("reach-technical-text", toggle.is(':checked'));
        toggleRow("reach-technical-valoration", toggle.is(':checked'));
        //---------------------------------------------------------------------
        toggle = $j("[id$=reach-third-party-required-checkbox]");
        toggle.click(function () {
            toggleRow("reach-third-party-amount", this.checked);
        });
        toggleRow("reach-third-party-amount", toggle.is(':checked'));
        //---------------------------------------------------------------------
        toggle = $j("[id$=reach-hire-checkbox]");
        toggle.click(function () {
            toggleRow("reach-hire-amount", this.checked);
        });
        toggleRow("reach-hire-amount", toggle.is(':checked'));
        //---------------------------------------------------------------------
        toggle = $j("[id$=team-fte-not-present]");
        var toggleB = $j("[id$=team-fte-third-party]");
        var toggleFunction = function () {
            toggleRow("team-fte-detail", 
                      ($j("[id$=team-fte-not-present]").find('option:selected').val() !== "" && 
                       $j("[id$=team-fte-not-present]").find('option:selected').val() !== "0") ||
                      ($j("[id$=team-fte-third-party]").find('option:selected').val() !== "" && 
                       $j("[id$=team-fte-third-party]").find('option:selected').val() !== "0"));
        }
        toggle.click(toggleFunction);
        toggleB.click(toggleFunction);
        toggleFunction();
        //---------------------------------------------------------------------
        toggle = $j("[id$=risk-project-SLA-checkbox]");
        toggle.click(function () {
            toggleRowClass("risk-project-SLA-detail", this.checked);
            toggleRow("risk-project-SLA-valoration", this.checked);
        });
        toggleRowClass("risk-project-SLA-detail", toggle.is(':checked'));
        toggleRow("risk-project-SLA-valoration", toggle.is(':checked'));
    }
    
    function toggleRow(id, condition) {
        //the closest("tr") obtain the element that is generated as 
        //part of the pageBlockSection that contains both the title and
        //the input field
        if(condition) {
            $j("[id$=" + id + "]").closest("tr").show("fast");
        }
        else {
            $j("[id$=" + id + "]").closest("tr").hide("fast");
        }
    }
    
    function toggleRowClass(aClass, condition) {
        //the closest("tr") obtain the element that is generated as 
        //part of the pageBlockSection that contains both the title and
        //the input field
        if(condition) {
            $j("." + aClass).closest("tr").show("fast");
        }
        else {
            $j("." + aClass).closest("tr").hide("fast");
        }
    }
    
    function fillInitiative() {
        $j("#spanIniciative input").val($j("#textIniciative").val());
        $j("#textIniciative").val("");
    }
    
    
    function setearValorIdDelRetoActual(id){
        $j(".setearIdDelRetoDelContacto").val(id);
    }
    
    function setearValorIdDeSolucionActual(id){
        $j(".setearIdDeSolucion").val(id);
    }
    
    function twistSectionInsideARepeat(twisty, sectionId) {
        var parentDiv = twisty;
        while (parentDiv.tagName != 'DIV') { parentDiv = parentDiv.parentNode; }
        var div = parentDiv.nextSibling; 
        var elemWasOn = false; 
        if (div.style.display != 'none') { 
            div.style.display = 'none'; 
            twisty.className ='showListButton';
            twisty.alt = twisty.title = 'Mostrar sección - '+twisty.name;
            elemWasOn = true; 
        } else {
            div.style.display = 'block'; 
            twisty.className = 'hideListButton';
            twisty.alt = twisty.title = 'Ocultar sección - '+twisty.name;
        } 
        return !elemWasOn;
    }
    
    function botonSi () {
        $j( "#detail-reach" ).click();
        $j('body').animate({ scrollTop: 127 }, 400);
    }
    
    function probandoRender(){
        $j("[data-toggle='tab']").toggle('destroy')                 
        $j("[data-toggle='tab']").toggle('create');    
        
    }
    
    
    function pruebaCategoria(){
        console.log($j(".tipoDeCategoriaEnTabla").val());
        if($j(".tipoDeCategoriaEnTabla").val() === 'Otro'){
            $j('.campoDeCategoriaEnTabla').removeClass('ocultar');
        }else{
            $j('.campoDeCategoriaEnTabla').addClass('ocultar');
        }            
    }
    
    
    
    function cambiarColor(id){
        
        var picklist = $j("."+id);
        
        console.log(picklist.val());
        
        if(picklist.val() == 'Oportunidades Ganadas'){
            $j("#"+id).css('background-color','#337ab7');
        }
        
        if(picklist.val() == 'Oportunidades en Funnel'){
            $j("#"+id).css('background-color','green');
        }
        
        if(picklist.val() == 'Lineas de trabajo Priorizadas'){
            $j("#"+id).css('background-color','orange');
        }
        if(picklist.val() == 'Lineas a Explorar'){
            $j("#"+id).css('background-color','grey');
        }
        if(picklist.val() == 'Lineas que no Aplican en el Cliente'){
            $j("#"+id).css('background-color','red');
        }
        if(picklist.val() == ''){
            $j("#"+id).css('background-color','black');
        }
        
    }
    
    
    
    </script>
    
    <apex:outputpanel styleClass="container-fluid bootstrap-sf1" id="pageContent">
        <apex:form >
            <div class="panel panel-default">
                <div class="panel-heading" style="height: 70px;">
                    <h2 class="panel-title">
                        <span style="float:left;">
                            Vencimientos (Total Cartera)
                        </span>
                    </h2>
                    
                    
                    <div class="row paddingRight">
                        <div class="btn-group pull-right" role="group" >
                            
                            <apex:outputPanel id="buttonPanel">
                                <div class="btn-group pull-right" role="group" aria-label="...">
                                    <!--
<button style="margin-top:-14%;float:left;" type="button" class="btn btn-default btn-sm" onclick="SaveChanges()">
<span class="glyphicon glyphicon-floppy-disk icon-btn-left"></span>&nbsp;{!$Label.Guardar_Datos} 
</button>                              
-->                             
<button type="button" class="btn btn-default btn-sm" onclick="irAInicio()">
                                    <!--<apex:image style="height:35px;" url="{!URLFOR($Resource.icono4Planning)}" styleClass="icon-sectors-botonera"/>-->
                                    <span class="glyphicon glyphicon-home"></span>&nbsp; 4Planning
                                </button>                              
                                
                                <apex:actionFunction action="{!irAlTab}" name="irAInicio" status="renderMeStatus"/>
                                    
                                    <apex:actionStatus id="loadingSave">
                                        <apex:facet name="start">
                                            <img src="/img/loading.gif"/>
                                        </apex:facet>
                                    </apex:actionStatus>
                                    
                                </div>
                            </apex:outputPanel>  
                            
                        </div>
                    </div>
                </div>
                
                <div class="panel-body">

                    <div class="tab-content" id="big-deal-tab-content">
                        

                        <!-- Vencimiento -->
                        <div id="div-vencimiento" >
                            <apex:pageBlock title="" mode="maindetail" id="presupuesto">
                                
                                <!--<apex:pageBlockSection id="todo" title="Papa" columns="1">
                                    
                                    
                                    <apex:pageBlockSectionItem >
                                        <apex:outputPanel id="panelSoluciones" layout="none"  >-->
                                            
                                            <br/>
                                            <br/>
                                            
                                            <div style="
                                                        justify-content: center;
                                                        align-items: center; ">
                                                
                                                <div id="vencimientos" style="width: 1250px;">    
                                                </div>
                                                
                                            </div>
                                            <script>
                                            
                                            // Vencimientos Fijos.
                                            
                                            var todosLosVencimientos = [];
                                            
                                            var vencimientosFijos = {!vencimientosFijosJson};
                                            
                                            console.log('aca abajo las fechas');
                                            console.log({!fechasJson});
                                            
                                            var xFijos = [];
                                            var yFijos = [];
                                            for(i=0; i< vencimientosFijos.length ; i++){
                                                todosLosVencimientos.push(vencimientosFijos[i]);
                                                xFijos.push(vencimientosFijos[i].mes);
                                                yFijos.push(vencimientosFijos[i].fcv);
                                            }
                                            
                                            var fijos = {
                                                x: xFijos,
                                                y: yFijos,
                                                name: 'Fija',
                                                type: 'bar'
                                            };
                                            
                                            // Vencimientos Movil.
                                            var vencimientosMovil = {!vencimientosMovilJson};
                                            
                                            var xMovil = [];
                                            var yMovil = [];
                                            for(i=0; i< vencimientosMovil.length ; i++){
                                                todosLosVencimientos.push(vencimientosMovil[i]);
                                                xMovil.push(vencimientosMovil[i].mes);
                                                yMovil.push(vencimientosMovil[i].fcv);
                                            }
                                            
                                            console.log(xMovil);
                                            console.log(yMovil);
                                            
                                            var movil = {
                                                x: xMovil,
                                                y: yMovil,
                                                name: 'Movil',
                                                type: 'bar'
                                            };
                                            
                                            // Servicios Digitales.
                                            var vencimientosDigitales = {!vencimientosServiciosDigitalesJson};
                                            
                                            
                                            var xDigital = [];
                                            var yDigital = [];
                                            for(i=0; i< vencimientosDigitales.length ; i++){
                                                todosLosVencimientos.push(vencimientosDigitales[i]);
                                                xDigital.push(vencimientosDigitales[i].mes);
                                                yDigital.push(vencimientosDigitales[i].fcv);
                                            }
                                            
                                            var digital = {
                                                x: xDigital,
                                                y: yDigital,
                                                name: 'Servicios Digitales',
                                                type: 'bar'
                                            };
                                            
                                            // Otros.
                                            var vencimientosOtros = {!vencimientosOtrosJson};
                                            
                                            vencimientosOtros.sort(function(a, b) { 
                                                return a.claveOrdenar - b.claveOrdenar;
                                            })
                                            
                                            console.log('la de aca abajo');
                                            console.log(vencimientosOtros);
                                            
                                            var xOtros = [];
                                            var yOtros = [];
                                            for(i=0; i< vencimientosOtros.length ; i++){
                                                todosLosVencimientos.push(vencimientosOtros[i]);
                                                xOtros.push(vencimientosOtros[i].mes);
                                                yOtros.push(vencimientosOtros[i].fcv);
                                            }
                                            
                                            console.log(xOtros);
                                            console.log(yOtros);
                                            
                                            console.log('todos los vencimientos:');
                                            console.log(todosLosVencimientos);
                                            
                                            todosLosVencimientos.sort(function(a, b) { 
                                                return a.claveOrdenar - b.claveOrdenar;
                                            })
                                            
                                            var todosLosx = [];
                                            for(i=0; i< todosLosVencimientos.length ; i++){
                                                todosLosx.push(todosLosVencimientos[i].mes);
                                            }
                                            
                                            
                                            var uniqueNames = [];
                                            $j.each(todosLosx, function(i, el){
                                                if($j.inArray(el, uniqueNames) === -1) uniqueNames.push(el);
                                            });
                                            
                                            var otros = {
                                                x: xOtros,
                                                y: yOtros,
                                                name: 'Otros',
                                                type: 'bar'
                                            };
                                            
                                            
                                            var data = [fijos, movil, digital, otros];
                                            
                                            uniqueNames = {!fechasJson};
                                            
                                            var layout = {
                                                width: 1250,
                                                barmode: 'stack',
                                                xaxis: {
                                                    categoryorder:'array',
                                                    categoryarray: uniqueNames,
                                                }        
                                            };
                                            
                                            Plotly.newPlot('vencimientos', data, layout, {displayModeBar: true, displaylogo: false, showlegend: false, modeBarButtonsToRemove: ['toImage','sendDataToCloud','zoom2d','select2d','lasso2d','hoverClosestCartesian','hoverCompareCartesian','autoScale2d'] });
                                            </script>
                                            
                                            <div style="overflow: auto;max-height: 120vh;">
                                                <table id="mainOppsTable" style="width: 90%;margin-left: 5%;margin-bottom: 0px;" class ="table table-striped table-bordered table-condensed">
                                                    <thead>
                                                        <tr>
                                                            <th class="thVencimiento">
                                                                Nombre de la Cuenta
                                                            </th>
                                                            <th class="thVencimiento">
                                                                Nombre de la Oportunidad
                                                            </th>
                                                            <th class="thVencimiento">
                                                                Linea de Negocio
                                                            </th>
                                                            <th class="thVencimiento">
                                                                Fecha Fin de Contrato
                                                            </th>
                                                            <th class="thVencimiento">
                                                                Venta Bruta Total (FCV)
                                                            </th>
                                                            <th class="thVencimiento">
                                                                Link 
                                                            </th>
                                                        </tr>
                                                    </thead>
                                                    <apex:repeat value="{!wrapersOportunidadesVencimientos}" var="opp">
                                                        <tr>
                                                            <td style="text-align:center">
                                                                {!opp.oportunidad.account.name}
                                                            </td>                                                            
                                                            <td style="text-align:center">
                                                                {!opp.name}
                                                            </td>
                                                            <td style="text-align:center">
                                                                {!opp.lineaDeNegocio}
                                                            </td>
                                                            <td style="text-align:center">
                                                                <apex:outputText value="{0,date,dd/MM/yy}"> 
                                                                    <apex:param value="{!opp.fecha}" /> 
                                                                </apex:outputText> 
                                                                
                                                            </td>
                                                            <td style="text-align:center">
                                                                
                                                                
                                                                <apex:outputField value="{!opp.opp.currency2__c}" />
                                                                
                                                                <apex:outputText rendered="{!opp.fcv = null}">0</apex:outputText>
                                                            </td>
                                                            <td style="text-align:center">
                                                                <apex:outputLink value="/{!opp.id}">Ir a la Oportunidad</apex:outputLink>
                                                            </td>
                                                        </tr>
                                                    </apex:repeat>
                                                </table>
                                                
                                            </div>
                                            
                                            <!-- ----------------------------------------------------------------------------- -->
                                            
                                
                            </apex:pageBlock>
                        </div>
                        
                      
                                    </div>
                    
                </div>
                
            </div>
        </apex:form>
    </apex:outputpanel>
</apex:page>